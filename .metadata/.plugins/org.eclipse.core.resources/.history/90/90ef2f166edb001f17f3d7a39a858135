package de.uni_koeln.hs

class SearchController {
	
	static allowedMethods = [result:"POST"]
	
	def index = {
	}
	
	def result = {
		
		def q = params.query.split();
		
		
		//		def res1 = Name.findAll("from Name as n where n.firstName like :search or n.lastName like :search", [search:"%le%"])
		//		println(res1)
		//		
		//		def res2 = Name.find("from Name as n where n.id = :search", [search:8L])
		//		println(res2)
		
		//		def personID = Name.executeQuery("select n.person.id, n.lastName, n.firstName from Name n where n.lastName like :search", [search:"%"+params.query+"%"])
		//		println(personID)
		
		//		def c = Person.createCriteria()
		//		def work = c.list {
		//			works {
		//				like('workTitle', "%er%")
		//			}
		//		}
		//		println(work)
		
		
		def matches = []
		def person = [:]
		
		q.each { str ->  
			
			def name = Name.withCriteria {
				or {
					like('lastName', "%"+str+"%")
					like('firstName', "%"+str+"%")
				}
			}
			
			def location = Location.withCriteria {
				or {
					like('country', "%"+str+"%")
					like('city', "%"+str+"%")
				}
			}
			
			def confession = Confession.withCriteria {
				like('confessionType', "%"+str+"%")
			}
			
			def work = Work.withCriteria {
				or {
					like('workTitle', "%"+str+"%")
					like('subtitle', "%"+str+"%")
				}
			}
			
			//				println(name)
			//				println(location)
			//				println(confession)
			//				println(work)
						
//			if(name != []) {
//				def n = retrievePersonByName(name)
//				println(n)
//				// TODO :Loop
////				person.put(n, ++person.get(n,1))
//			}
			if(location != []) {
				def l = retrievePersonByLocation(location)
				println(l)
//				person.put(l, ++person.get(l, 1))
			}
//			if(confession != []) {
//				def c = retrievePersonByConfession(confession)
//				person.put(c, ++person.get(c, 1))
//			}
//			if(work != []) {
//				def w = retrievePersonByWork(work)
//				person.put(w, ++person.get(w, 1))
//			}
		}
		// person.put(p, ++person.get(p, 1))
	}
	
	def retrievePersonByName =  { name -> 
		Name.executeQuery("select n.person.id from Name n where n.id = :id", [id: name.id])
	}
	
	def retrievePersonByLocation = { location ->
		Location.executeQuery("select `person_id` from `person_locations` where `location_id` = " + location.id )
	}
	
	
	
	
}
