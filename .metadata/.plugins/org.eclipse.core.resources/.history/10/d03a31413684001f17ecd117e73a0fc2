package de.uni_koeln.hki.thaller

import java.util.StringTokenizer;

class Person {
	
	String bio
	String  dateOfBirth
	String  dateOfDeath
	boolean gender
	
	String year
	String month
	String day
	
	
	static transients = [ "year", "month", "day" ]
	
	
	static hasMany = [names:Name, relations:Relation, confessions:Confession,
	locations:Location, works:Work]
	
	static constraints = {
		dateOfBirth(validator:{val, obj ->
			if(val?.matches("[0-9]{3,4}(-[0-9]{2})?(-[0-9]{2})?")) {
				String[] str = val?.split("-")
				StringBuilder sb = new StringBuilder();
				for (int i = 0; i < str.length; i++) {
					String s = str[i];
					switch(i) {
						case 0 : 
							if (s.length() == 3 || s.length() == 4)
								sb.append(str[i]).append("-")
							break;
						case 1 : 
							if (s.length() == 2 && Integer.parseInt(s) <= 12)
								sb.append(str[i]).append("-")
							break;
						case 2 : 
							if(s.length() == 2 && Integer.parseInt(s) <= 31)
								sb.append(str[i]).append("-")
							break;
						default: 
							break;
					}
				}
				dateOfBirth = sb.toString();
				
				return true
			}
			else {
				return false
			}
			
			
			
			//			if(obj.dateOfDeath != null)
			//			if(val?.compareTo(obj.dateOfDeath) >= 0) {
			//				return false
			//			}
		})
		dateOfDeath(nullable:true)
		bio(maxSize:10000)
	}
	
	
	
}
